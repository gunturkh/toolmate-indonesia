---
import BaseLayout from '@layouts/BaseLayout.astro';
import ProjectCard from '@components/ProjectCard.astro';
import { getCollection } from 'astro:content';
import { pageSEO } from '@data/seo';

const projectsData = await getCollection('projects');
const projects = projectsData.map(p => p.data);
---

<BaseLayout
  title={pageSEO.projects.title}
  description={pageSEO.projects.description}
  keywords={pageSEO.projects.keywords}
  activePage="projects"
  flexLayout={true}
>

  <!-- HERO -->
  <div class="bg-slate-900 pt-32 pb-16 text-center">
    <h1 class="text-4xl font-bold text-white mb-2">Project References</h1>
    <p class="text-slate-400">Proven track record with multinational clients in Batam.</p>
  </div>

  <!-- PROJECTS GRID -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

    <!-- Filters -->
    <div id="filter-buttons" class="flex flex-wrap justify-center gap-4 mb-12">
      <button data-filter="all" class="filter-btn active px-4 py-2 bg-brand-navy text-white rounded-full text-sm font-bold transition hover:bg-blue-900">All Projects</button>
      <button data-filter="wwtp" class="filter-btn px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-semibold transition hover:bg-slate-200">WWTP</button>
      <button data-filter="hvac" class="filter-btn px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-semibold transition hover:bg-slate-200">HVAC</button>
      <button data-filter="civil" class="filter-btn px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-semibold transition hover:bg-slate-200">Civil</button>
      <button data-filter="structure" class="filter-btn px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-semibold transition hover:bg-slate-200">Structure</button>
      <button data-filter="mne" class="filter-btn px-4 py-2 bg-slate-100 text-slate-600 rounded-full text-sm font-semibold transition hover:bg-slate-200">M&E</button>
    </div>

    <div id="projects-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
      {projects.map((project) => (
        <ProjectCard {...project} />
      ))}
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="hidden text-center py-12">
      <i class="fas fa-search text-4xl text-slate-300 mb-4"></i>
      <p class="text-slate-500">No projects found in this category.</p>
    </div>

    <!-- DOWNLOAD SECTION -->
    <div class="mt-20 bg-brand-navy rounded-xl p-8 md:p-12 text-white text-center">
      <h3 class="text-2xl font-bold mb-4">Download Full Project List</h3>
      <p class="mb-8 text-blue-100">Get the detailed reference list including project values and timelines.</p>
      <a href="YOUR_GOOGLE_DRIVE_LINK_HERE" target="_blank" class="inline-flex items-center bg-brand-gold text-brand-navy font-bold px-6 py-3 rounded hover:bg-white transition">
        <i class="fas fa-download mr-2"></i> Download Reference List (PDF)
      </a>
    </div>
  </div>

</BaseLayout>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectCards = document.querySelectorAll('.project-card');
  const noResults = document.getElementById('no-results');

  filterButtons.forEach(button => {
    button.addEventListener('click', function() {
      const filter = this.dataset.filter;

      filterButtons.forEach(btn => {
        btn.classList.remove('active', 'bg-brand-navy', 'text-white');
        btn.classList.add('bg-slate-100', 'text-slate-600');
      });
      this.classList.add('active', 'bg-brand-navy', 'text-white');
      this.classList.remove('bg-slate-100', 'text-slate-600');

      let visibleCount = 0;
      projectCards.forEach(card => {
        const category = card.dataset.category;
        if (filter === 'all' || category === filter) {
          card.classList.remove('hidden');
          visibleCount++;
        } else {
          card.classList.add('hidden');
        }
      });

      if (noResults) {
        if (visibleCount === 0) {
          noResults.classList.remove('hidden');
        } else {
          noResults.classList.add('hidden');
        }
      }
    });
  });
});
</script>
